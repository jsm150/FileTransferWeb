# Transfer 도메인 규칙

## 도메인 소유 규칙

1. 업로드 완료 처리의 애플리케이션 진입점은 `TusUploadCompletedNotificationHandler` 단일 경로를 사용한다.
2. 전송 프로토콜(tus 청크 수신/오프셋 관리)는 인프라 책임이며 도메인 규칙 판단은 하지 않는다.
3. 업로드 대상 경로는 비어 있을 수 없다.
4. 업로드 파일 목록은 비어 있을 수 없다.
5. 업로드 파일 이름은 비어 있을 수 없다.
6. 파일 처리 결과 목록은 비어 있을 수 없다.
7. 파일 처리 결과가 전부 성공이면 `Completed`, 전부 실패이면 `Failed`, 일부 성공이면 `PartiallyCompleted` 상태로 전이한다.
8. 파일명 충돌 시 `UploadFileNamePolicy`가 단일 스캔 분석 결과로 `name (n).ext` 규칙의 최소 사용 가능 번호를 결정한다.
9. 같은 요청 내 중복 파일도 정책 내부 예약 상태로 즉시 점유 처리한다.
10. 파일명 정규화(`Path.GetFileName`, 공백 시 기본 이름 대체)는 도메인 정책이 담당한다.
11. 도메인 계층에서 발생하는 예외는 `TransferDomainException`으로 통일한다.
12. Transfer 도메인은 도메인 이벤트를 발행하지 않고, 상태 전이는 `UploadJob` 집합 루트의 메서드로만 수행한다.
